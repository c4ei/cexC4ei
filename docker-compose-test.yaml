version: "2.0"

services:
  test:
    build:
      context: .
      dockerfile: Dockerfile.test
    environment:
      - DEBUG=${DEBUG}
      - SERVER_PORT=${SERVER_PORT}
      - NEO4J_URL=${NEO4J_URL}
      - NEO4J_USER=${NEO4J_USER}
      - NEO4J_PASSWORD=${NEO4J_PASSWORD}
      - REDIS_HOST=${REDIS_HOST}
      - REDIS_PORT=${REDIS_PORT}
      - REDIS_RECEIVER_DEPLOY_QUEUE=${REDIS_RECEIVER_DEPLOY_QUEUE}
      - REDIS_RECEIVER_DEPLOYED_QUEUE=${REDIS_RECEIVER_DEPLOYED_QUEUE}
      - REDIS_RECEIVER_DB=${REDIS_RECEIVER_DB}
      - REDIS_WITHDRAWER_WITHDRAW_QUEUE=${REDIS_WITHDRAWER_WITHDRAW_QUEUE}
      - REDIS_WITHDRAWER_WITHDRAWN_QUEUE=${REDIS_WITHDRAWER_WITHDRAWN_QUEUE}
      - REDIS_WITHDRAWER_DB=${REDIS_WITHDRAWER_DB}
      - WEB3_HTTP_PROVIDER=${WEB3_HTTP_PROVIDER}
      - TRANSACTION_SIGNER_PRIVATE_KEY=${TRANSACTION_SIGNER_PRIVATE_KEY}
      - TRANSACTION_SIGNER_PRIVATE_KEY_HEX=${TRANSACTION_SIGNER_PRIVATE_KEY_HEX}
      - TRANSACTION_SIGNER_PUBLIC_KEY=${TRANSACTION_SIGNER_PUBLIC_KEY}
      - BANK_ID=${BANK_ID}
      - WATCHER_INTERVAL_MILLISECONDS=${WATCHER_INTERVAL_MILLISECONDS}
      - USDT_ADDRESS=${USDT_ADDRESS}
      - JWT_SECRET=${JWT_SECRET}
      - ERC20_TRANSFER_GAS=${ERC20_TRANSFER_GAS}
      - RECEIVER_DEPLOY_GAS=${RECEIVER_DEPLOY_GAS}
      - BANK_DEPLOY_GAS=${BANK_DEPLOY_GAS}
      - TEST_ERC20_DEPLOY_GAS=${TEST_ERC20_DEPLOY_GAS}
    ports:
      - 4000:4000
    depends_on:
      neo4j:
        condition: service_healthy
      redis:
        condition: service_healthy
      ganache:
        condition: service_started
